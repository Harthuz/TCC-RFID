@startuml
actor "Sistema de Prateleira Inteligente" as SPI <<Secundário>>
actor "Banco de Dados" as BD <<Secundário>>
actor "Gerente" as Gerente <<Primário>>
actor "Administrador" as Admin <<Primário>>
actor "Sistema de Notificação" as NotificacaoSystem <<Secundário>>
actor "Backend" as Backend <<Secundário>>

usecase "Detectar Alteração de Produto na Prateleira" as Detectar
usecase "Gerenciar Alteração de Estoque Detectada" as GerenciarAlteracao
usecase "Registrar Entrada de Produto" as Entrada
usecase "Registrar Saída de Produto" as Saida
usecase "Processar e Persistir Dados de Estoque" as ProcessarPersistir
usecase "Receber Dados do Leitor RFID (IoT)" as ReceberIoT
usecase "Fornecer Dados para Dashboard" as FornecerDashboard
usecase "Realizar Login" as RealizarLogin
usecase "Consultar Histórico de Movimentações" as ConsultarHistorico
usecase "Visualizar Status da Prateleira" as VisualizarStatus
usecase "Visualizar Alerta de Produto" as VisualizarAlertaProduto
usecase "Alterar Quantidade de Estoque Manualmente" as AlterarEstoque
usecase "Gerar Alerta de Baixo Estoque" as GerarAlertaAcabando
usecase "Gerar Alerta de Vencimento Próximo" as GerarAlertaVencendo
usecase "Enviar Notificação Automática" as EnviarNotificacao

' Relações do Sistema de Prateleira Inteligente (IoT)
SPI --> Detectar : <<inicia>>
Detectar --> GerenciarAlteracao : <<include>>

GerenciarAlteracao <|-- Entrada : <<extend>> (condição: Produto adicionado)
GerenciarAlteracao <|-- Saida : <<extend>> (condição: Produto removido)

' Ajuste: O Backend é o responsável por receber e processar dados, não o SPI diretamente.
' O SPI (Leitor RFID/Microcontrolador) envia dados para o Backend.
Backend --> ReceberIoT : <<inicia>> (recebe do Microcontrolador)
ReceberIoT --> ProcessarPersistir : <<include>>
ProcessarPersistir --> BD : <<usa>> (grava/atualiza)
BD --> ProcessarPersistir : <<usa>> (consulta)

' Relações do Backend com alertas
Backend --> GerarAlertaAcabando : <<inicia>> (com base em regras de estoque)
Backend --> GerarAlertaVencendo : <<inicia>> (com base em regras de validade)
GerarAlertaAcabando --> EnviarNotificacao : <<include>>
GerarAlertaVencendo --> EnviarNotificacao : <<include>>

NotificacaoSystem <-- EnviarNotificacao : <<usa>> (envia notificação)

' Relações com o Dashboard / Usuários
Gerente --> RealizarLogin
Admin --> RealizarLogin

Gerente --> ConsultarHistorico : <<acessa via Dashboard>>
Gerente --> VisualizarStatus : <<acessa via Dashboard>>
Gerente --> VisualizarAlertaProduto : <<acessa via Dashboard>>

Admin --> AlterarEstoque : <<acessa via Dashboard>>

Backend --> FornecerDashboard : <<inicia>> (disponibiliza dados)
FornecerDashboard --> ConsultarHistorico : <<inclui>>
FornecerDashboard --> VisualizarStatus : <<inclui>>
FornecerDashboard --> VisualizarAlertaAcabando : <<inclui>>
FornecerDashboard --> VisualizarAlertaVencendo : <<inclui>>

@enduml